<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‹¤ë¦¬ ê±´ë„ˆê¸° í¼ì¦ - Dark Edition</title>

  <!-- ê³ ê¸‰ìŠ¤ëŸ½ê³  ê¹”ë”í•œ í•œêµ­ì–´ ì„œì²´ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/static/pretendard.css" />

  <style>
    body {
      font-family: "Pretendard", sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      background: #0d1117; /* Github ë‹¤í¬í…Œë§ˆ ëŠë‚Œ */
      color: #e6edf3;
    }

    /* ê³µí†µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    button {
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      background: #238636; /* GitHub ê·¸ë¦° ë²„íŠ¼ */
      color: #fff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover {
      background: #2ea043;
    }
    #next { background: #0969da; }
    #next:hover { background: #1a7fdb; }
    #reset { background: #6e7681; }
    #reset:hover { background: #8c939d; }

    /* ì‹œì‘ í™”ë©´ */
    #start-screen {
      margin-top: 120px;
    }
    .start-title {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 16px;
      color: #fff;
    }
    .start-sub {
      font-size: 18px;
      margin-bottom: 30px;
      color: #8b949e;
    }
    .primary-btn {
      padding: 16px 30px;
      font-size: 20px;
      border-radius: 10px;
      background: #0969da;
    }

    /* ê²Œì„ ì»¨í…Œì´ë„ˆ */
    #game-container {
      display: inline-block;
      margin-top: 30px;
    }

    #canvas {
      border-radius: 14px;
      background: #161b22; /* ì–´ë‘ìš´ ìº”ë²„ìŠ¤ */
      width: 600px;
      height: 400px;
      box-shadow: 0 8px 28px rgba(0,0,0,0.45);
      cursor: pointer;
    }

    /* ì •ë³´ íŒ¨ë„ */
    #info {
      margin-top: 16px;
      background: #21262d;
      padding: 14px 20px;
      border-radius: 10px;
      font-size: 15px;
      text-align: left;
      width: 560px;
      display: inline-block;
      color: #c9d1d9;
    }

    .btn-group { margin-top: 12px; }

    /* ì˜¤ë²„ë ˆì´ (í¬ê¸°/í•´ì„¤) */
    #overlay, #result-overlay {
      position: absolute;
      top: 50%; left: 50%;
      width: 100%;
      height: 100%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    .overlay-box {
      background: #161b22;
      color: #e6edf3;
      padding: 20px 26px;
      border-radius: 12px;
      width: 380px;
      text-align: left;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .overlay-buttons {
      margin-top: 20px;
      text-align: right;
    }
  </style>
</head>
<body>

<!-- ì‹œì‘ í™”ë©´ -->
<div id="start-screen">
  <div class="start-title">ë‹¤ë¦¬ ê±´ë„ˆê¸° í¼ì¦</div>
  <div class="start-sub">ëª¨ë“  ë‹¤ë¦¬ë¥¼ <strong>ë‹¨ í•œ ë²ˆì”©</strong> ê±´ë„ˆë¼</div>
  <button class="primary-btn" id="start-btn">ê²Œì„ ì‹œì‘</button>
</div>

<!-- ê²Œì„ í™”ë©´ -->
<div id="game-container" style="display:none;">
  <canvas id="canvas" width="600" height="400"></canvas>

  <!-- í¬ê¸° ì˜¤ë²„ë ˆì´ -->
  <div id="overlay">
    <div class="overlay-box">
      <h3>í¬ê¸°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
      <p>ì´ ìŠ¤í…Œì´ì§€(5)ëŠ” ìˆ˜í•™ì ìœ¼ë¡œ í•œë¶“ê·¸ë¦¬ê¸°ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
      <div class="overlay-buttons">
        <button id="giveup-cancel">ì•„ë‹ˆìš”</button>
        <button id="giveup-confirm">í•´ì„¤ ë³´ê¸°</button>
      </div>
    </div>
  </div>

  <!-- í•´ì„¤ ì˜¤ë²„ë ˆì´ -->
  <div id="result-overlay">
    <div class="overlay-box">
      <h3>ì¾¨ë‹ˆíˆìŠ¤ë² ë¥´í¬ì˜ ë‹¤ë¦¬</h3>
      <p>í™€ìˆ˜ ì°¨ìˆ˜ ì •ì ì´ 4ê°œ â†’ í•œë¶“ê·¸ë¦¬ê¸° ë¶ˆê°€ëŠ¥.</p>
      <p>ì¦‰, ì ˆëŒ€ ê¹° ìˆ˜ ì—†ëŠ” ìŠ¤í…Œì´ì§€ì…ë‹ˆë‹¤.</p>
      <div class="overlay-buttons">
        <button id="result-close">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>
  </div>

  <div id="info"></div>

  <div class="btn-group">
    <button id="reset">ìŠ¤í…Œì´ì§€ ë¦¬ì…‹</button>
    <button id="next" style="display:none;">ë‹¤ìŒ ìŠ¤í…Œì´ì§€</button>
  </div>
</div>

<script>
/* ======================================
       ìŠ¤í…Œì´ì§€ ë°ì´í„° (ë‹¤í¬í…Œë§ˆ ë™ì¼)
====================================== */

const levels = [
  {
    id: 1,
    title: "Stage 1 - ê¸°ë³¸ ì—°ìŠµ",
    description: "ê°€ì¥ ë‹¨ìˆœí•œ êµ¬ì¡°ì…ë‹ˆë‹¤.",
    nodes: [
      { id: 0, x: 180, y: 120 },
      { id: 1, x: 420, y: 120 },
      { id: 2, x: 420, y: 280 },
      { id: 3, x: 180, y: 280 }
    ],
    edges: [
      { id:0,a:0,b:1 },
      { id:1,a:1,b:2 },
      { id:2,a:2,b:3 },
      { id:3,a:3,b:0 },
      { id:4,a:0,b:2 }
    ],
    startNode: 0
  },

  {
    id: 2,
    title: "Stage 2 - ë³„ ê·¸ë˜í”„",
    description: "êµì°¨ê°€ ë§ì€ ë³„ í˜•íƒœ",
    nodes: [
      { id:0,x:300,y:200 },
      { id:1,x:140,y:120 },
      { id:2,x:460,y:120 },
      { id:3,x:460,y:280 },
      { id:4,x:140,y:280 }
    ],
    edges: [
      { id:0,a:0,b:1 },
      { id:1,a:0,b:2 },
      { id:2,a:0,b:3 },
      { id:3,a:0,b:4 },
      { id:4,a:1,b:2 },
      { id:5,a:2,b:3 },
      { id:6,a:3,b:4 }
    ],
    startNode: 2
  },

  {
    id: 3,
    title: "Stage 3 - ìœ¡ê°í˜• ë¯¸ë¡œ",
    description: "ë³µì¡í•œ ìœ¡ê° êµ¬ì¡°ì…ë‹ˆë‹¤.",
    nodes: [
      { id:0,x:300,y:80 },
      { id:1,x:440,y:140 },
      { id:2,x:440,y:260 },
      { id:3,x:300,y:320 },
      { id:4,x:160,y:260 },
      { id:5,x:160,y:140 }
    ],
    edges: [
      { id:0,a:0,b:1 },
      { id:1,a:1,b:2 },
      { id:2,a:2,b:3 },
      { id:3,a:3,b:4 },
      { id:4,a:4,b:5 },
      { id:5,a:5,b:0 },
      { id:6,a:0,b:3 },
      { id:7,a:2,b:5 },
      { id:8,a:0,b:2 }
    ],
    startNode: 3
  },

  {
    id: 4,
    title: "Stage 4 - êµì°¨ ë‹¤ë¦¬",
    description: "êµì°¨ê°€ ë§¤ìš° ë§ì€ ê¹Œë‹¤ë¡œìš´ ê·¸ë˜í”„.",
    nodes: [
      { id:0,x:140,y:120 },
      { id:1,x:460,y:120 },
      { id:2,x:460,y:280 },
      { id:3,x:140,y:280 }
    ],
    edges: [
      { id:0,a:0,b:1 },
      { id:1,a:1,b:2 },
      { id:2,a:2,b:3 },
      { id:3,a:3,b:0 },
      { id:4,a:0,b:2 },
      { id:5,a:0,b:2 },
      { id:6,a:1,b:3 },
      { id:7,a:1,b:3 },
      { id:8,a:0,b:1 }
    ],
    startNode: 0
  },

  {
    id: 5,
    title: "Stage 5 - ì¾¨ë‹ˆíˆìŠ¤ë² ë¥´í¬",
    description: "ì ˆëŒ€ ê¹° ìˆ˜ ì—†ëŠ” ìŠ¤í…Œì´ì§€.",
    nodes: [
      { id:0,x:300,y:160 }, // ì¤‘ì•™
      { id:1,x:160,y:110 }, // ì™¼ìª½
      { id:2,x:440,y:110 }, // ì˜¤ë¥¸ìª½
      { id:3,x:300,y:290 }  // ì•„ë˜
    ],
    edges: [
      { id:0,a:0,b:1 },
      { id:1,a:0,b:1 },
      { id:2,a:0,b:2 },
      { id:3,a:0,b:2 },
      { id:4,a:0,b:3 },
      { id:5,a:1,b:3 },
      { id:6,a:2,b:3 }
    ],
    startNode: 0
  }
];

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const startScreen = document.getElementById("start-screen");
const gameContainer = document.getElementById("game-container");
const nextBtn  = document.getElementById("next");
const resetBtn = document.getElementById("reset");

const overlay       = document.getElementById("overlay");
const giveupCancel  = document.getElementById("giveup-cancel");
const giveupConfirm = document.getElementById("giveup-confirm");

const resultOverlay = document.getElementById("result-overlay");
const resultClose   = document.getElementById("result-close");

const infoDiv = document.getElementById("info");

let currentLevelIndex = 0;
let usedEdges = {};
let currentNodeId = 0;
let levelCleared = false;
let resetCount = 0;

let cheatArmed = false;

/* ======================================
        ë ˆë²¨ ì´ˆê¸°í™”
====================================== */

function getLevel() { return levels[currentLevelIndex]; }

function initLevel(i){
  currentLevelIndex = i;
  const level = getLevel();

  usedEdges = {};
  level.edges.forEach(e => usedEdges[e.id] = false);

  currentNodeId = level.startNode;
  levelCleared = false;
  resetCount = 0;

  draw();
  updateInfo();
  nextBtn.style.display = "none";
}

/* ======================================
        ê°• ê·¸ë¦¬ê¸° (ë‹¤í¬)
====================================== */
function drawRiver(level){
  ctx.save();
  ctx.fillStyle = "#0f1a28";  /* ì–´ë‘ìš´ íŒŒë€ ê°• */

  if(level.id===5){
    ctx.beginPath();
    ctx.moveTo(40,100);
    ctx.quadraticCurveTo(300,60,560,100);
    ctx.lineTo(560,140);
    ctx.quadraticCurveTo(300,110,40,140);
    ctx.closePath();
    ctx.fill();

    ctx.beginPath();
    ctx.moveTo(40,220);
    ctx.quadraticCurveTo(300,180,560,220);
    ctx.lineTo(560,260);
    ctx.quadraticCurveTo(300,230,40,260);
    ctx.closePath();
    ctx.fill();
  } else {
    ctx.beginPath();
    ctx.moveTo(80,140);
    ctx.quadraticCurveTo(300,110,520,140);
    ctx.lineTo(520,260);
    ctx.quadraticCurveTo(300,290,80,260);
    ctx.closePath();
    ctx.fill();
  }
  ctx.restore();
}

/* ======================================
        ë‹¤ë¦¬ (ê³¡ì„ )
====================================== */
function drawCurve(A, B, offset){
  const x1 = A.x, y1 = A.y;
  const x2 = B.x, y2 = B.y;

  const mx = (x1+x2)/2;
  const my = (y1+y2)/2;

  const dx = x2-x1;
  const dy = y2-y1;
  const len = Math.sqrt(dx*dx+dy*dy)||1;
  const nx = -dy/len;
  const ny = dx/len;

  const curve = 18 * (offset+1);

  const cx = mx + nx*curve;
  const cy = my + ny*curve;

  ctx.quadraticCurveTo(cx,cy,x2,y2);
}

/* ======================================
        ì „ì²´ ê·¸ë¦¬ê¸°
====================================== */
function draw(){
  const level = getLevel();

  ctx.clearRect(0,0,600,400);

  drawRiver(level);

  // ë‹¤ë¦¬
  level.edges.forEach(e=>{
    const A = level.nodes.find(n => n.id===e.a);
    const B = level.nodes.find(n => n.id===e.b);

    ctx.beginPath();
    ctx.moveTo(A.x, A.y);

    const used = usedEdges[e.id];
    ctx.lineWidth = 5;
    ctx.strokeStyle = used ? "#434c56" : "#00b8d9";  // ì‚¬ìš©ëœ ë‹¤ë¦¬ ì–´ë‘ìš´ íšŒìƒ‰ / ë¯¸ì‚¬ìš©: ë°ì€ ì²­ë¡

    const offset = e.offsetIndex || 0;
    drawCurve(A,B,offset);
    ctx.stroke();
  });

  // ì„¬
  level.nodes.forEach(n=>{
    ctx.beginPath();
    ctx.arc(n.x,n.y,18,0,Math.PI*2);
    ctx.fillStyle = (n.id===currentNodeId) ? "#f1c40f" : "#d0d7de";
    ctx.fill();
    ctx.strokeStyle="#333";
    ctx.lineWidth=2;
    ctx.stroke();

    ctx.fillStyle="#111";
    ctx.font="14px Pretendard";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(n.id, n.x, n.y);
  });
}

/* ======================================
        ì •ë³´ UI
====================================== */
function updateInfo(msg=""){
  const l = getLevel();
  const total = l.edges.length;
  const used  = Object.values(usedEdges).filter(v=>v).length;

  let t = `
    <strong>${l.title}</strong><br>
    ${l.description}<br><br>
    ì‚¬ìš©í•œ ë‹¤ë¦¬: ${used} / ${total}<br>
    í˜„ì¬ ìœ„ì¹˜í•œ ì„¬: ${currentNodeId}<br>
  `;
  if(msg) t += `<p style="color:#ff7675">${msg}</p>`;

  if(levelCleared && l.id<=4){
    t += `<p style="color:#2ecc71"><strong>í´ë¦¬ì–´! ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ì´ë™ ê°€ëŠ¥</strong></p>`;
  }

  infoDiv.innerHTML = t;
}

/* ======================================
        ìŠ¹ë¦¬ ì²´í¬
====================================== */
function checkWin(){
  const l = getLevel();
  const total = l.edges.length;
  const used = Object.values(usedEdges).filter(v=>v).length;
  if(used===total){
    levelCleared = true;
    updateInfo("ğŸ‰ ëª¨ë“  ë‹¤ë¦¬ë¥¼ í•œ ë²ˆì”© ì§€ë‚˜ê°”ìŠµë‹ˆë‹¤!");
    if(l.id<=4) nextBtn.style.display="inline-block";
    return true;
  }
  return false;
}

/* ======================================
        ìº”ë²„ìŠ¤ í´ë¦­
====================================== */
canvas.addEventListener("click", ev=>{
  const l = getLevel();
  const rect = canvas.getBoundingClientRect();

  const x = ev.clientX - rect.left;
  const y = ev.clientY - rect.top;

  const clicked = l.nodes.find(n => Math.hypot(n.x-x, n.y-y)<=20);
  if(!clicked) return;

  if(clicked.id===currentNodeId){
    updateInfo("ì´ë¯¸ ê·¸ ì„¬ì…ë‹ˆë‹¤.");
    return;
  }

  const edges = l.edges.filter(e=>{
    const ok =
      (e.a===currentNodeId && e.b===clicked.id) ||
      (e.b===currentNodeId && e.a===clicked.id);
    return ok && !usedEdges[e.id];
  });

  if(edges.length===0){
    updateInfo("ë” ì´ìƒ ê±´ë„ ìˆ˜ ìˆëŠ” ë‹¤ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  usedEdges[edges[0].id] = true;
  currentNodeId = clicked.id;

  draw();
  if(!checkWin()) updateInfo();
});

/* ======================================
        ì¹˜íŠ¸ (ìë™ê·¸ë¦¬ê¸°)
====================================== */
function animateClear(){
  const l = getLevel();
  let i = 0;

  function step(){
    if(i >= l.edges.length){
      checkWin();
      return;
    }
    usedEdges[l.edges[i].id] = true;
    draw();
    i++;
    setTimeout(step, 130);
  }
  step();
}

document.addEventListener("keydown", e=>{
  if(gameContainer.style.display==="none") return;

  if(e.key==="`"){
    cheatArmed = true; return;
  }
  if(!cheatArmed) return;

  if(e.key==="Enter"){
    animateClear();
  }else if(e.key==="ArrowLeft"){
    initLevel((currentLevelIndex-1+levels.length)%levels.length);
  }else if(e.key==="ArrowRight"){
    initLevel((currentLevelIndex+1)%levels.length);
  }

  cheatArmed = false;
});

/* ======================================
        ë¦¬ì…‹ ë²„íŠ¼
====================================== */
resetBtn.addEventListener("click", ()=>{
  const l = getLevel();
  if(l.id===5){
    resetCount++;
    if(resetCount>=5){
      overlay.style.display="flex";
      return;
    }
  }
  initLevel(currentLevelIndex);
});

/* ======================================
        ì˜¤ë²„ë ˆì´ ë²„íŠ¼
====================================== */
giveupCancel.addEventListener("click", ()=> overlay.style.display="none");
giveupConfirm.addEventListener("click", ()=>{
  overlay.style.display="none";
  resultOverlay.style.display="flex";
});
resultClose.addEventListener("click", ()=>{
  resultOverlay.style.display="none";
  initLevel(0);
});

/* ======================================
        ì‹œì‘ ë²„íŠ¼
====================================== */
document.getElementById("start-btn").addEventListener("click", ()=>{
  startScreen.style.display="none";
  gameContainer.style.display="inline-block";
  initLevel(0);
});
</script>

</body>
</html>
