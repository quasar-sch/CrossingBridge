<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‹¤ë¦¬ ê±´ë„ˆê¸° í¼ì¦</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/static/pretendard.css" />
  <style>
    body {
      font-family: "Pretendard", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      color: #222;
      text-align: center;
    }

    h1 {
      margin-top: 24px;
      margin-bottom: 8px;
    }

    /* ì‹œì‘ í™”ë©´ */
    #start-screen {
      margin-top: 120px;
    }
    .start-title {
      font-size: 42px;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .start-sub {
      font-size: 18px;
      color: #555;
      margin-bottom: 28px;
    }
    .primary-btn {
      padding: 14px 26px;
      font-size: 18px;
      border-radius: 10px;
      border: none;
      background: #1976d2;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }
    .primary-btn:hover {
      background: #115293;
    }

    /* ë²„íŠ¼ ê³µí†µ */
    button {
      font-family: inherit;
    }
    #reset, #next, #giveup-cancel, #giveup-confirm, #result-close {
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: 0.2s;
    }
    #reset {
      background: #9e9e9e;
      color: white;
    }
    #reset:hover { background: #757575; }
    #next {
      background: #1976d2;
      color: white;
    }
    #next:hover { background: #115293; }
    #giveup-cancel {
      background: #9e9e9e;
      color: white;
    }
    #giveup-confirm {
      background: #d32f2f;
      color: white;
    }
    #result-close {
      background: #1976d2;
      color: white;
    }

    /* ê²Œì„ ì»¨í…Œì´ë„ˆ: ì„¸ë¡œ ì •ë ¬ */
    #game-container {
      margin-top: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px; /* ìº”ë²„ìŠ¤-ì„¤ëª…-ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
    }

    #overlay-wrapper {
      position: relative;
      width: 600px;
      height: 400px;
    }

    #canvas {
      width: 600px;
      height: 400px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      cursor: pointer;
    }

    /* info íŒ¨ë„: ìº”ë²„ìŠ¤ ë°”ë¡œ ì•„ë˜ */
    #info {
      width: 600px;
      text-align: left;
      background: #ffffff;
      border-radius: 10px;
      padding: 12px 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      font-size: 14px;
      color: #333;
    }

    .btn-group {
      width: 600px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-bottom: 24px;
    }

    /* ì˜¤ë²„ë ˆì´ (í¬ê¸°/í•´ì„¤) - ìº”ë²„ìŠ¤ ìœ„ì—ë§Œ */
    #overlay,
    #result-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 600px;
      height: 400px;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
      border-radius: 12px;
    }
    .overlay-box {
      background: #ffffff;
      color: #222;
      padding: 18px 22px;
      border-radius: 10px;
      width: 360px;
      text-align: left;
      box-shadow: 0 8px 22px rgba(0,0,0,0.25);
      font-size: 14px;
    }
    .overlay-box h3 {
      margin-top: 0;
      margin-bottom: 8px;
    }
    .overlay-buttons {
      margin-top: 16px;
      text-align: right;
    }
  </style>
</head>
<body>

<h1>ë‹¤ë¦¬ ê±´ë„ˆê¸° í¼ì¦</h1>

<!-- ì‹œì‘ í™”ë©´ -->
<div id="start-screen">
  <div class="start-title">ë‹¤ë¦¬ ê±´ë„ˆê¸° í¼ì¦</div>
  <div class="start-sub">ì„¬ê³¼ ì„¬ì„ ì‡ëŠ” ëª¨ë“  ë‹¤ë¦¬ë¥¼ <strong>ë”± í•œ ë²ˆì”©</strong>ë§Œ ì§€ë‚˜ê°€ ë³´ì„¸ìš”.</div>
  <button class="primary-btn" id="start-btn">ê²Œì„ ì‹œì‘</button>
</div>

<!-- ê²Œì„ í™”ë©´ -->
<div id="game-container" style="display:none;">
  <div id="overlay-wrapper">
    <canvas id="canvas" width="600" height="400"></canvas>

    <!-- í¬ê¸° ì˜¤ë²„ë ˆì´ (ìŠ¤í…Œì´ì§€ 5 ì „ìš©) -->
    <div id="overlay">
      <div class="overlay-box">
        <h3>í¬ê¸°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
        <p>ì´ ìŠ¤í…Œì´ì§€(5)ëŠ” ìˆ˜í•™ì ìœ¼ë¡œ í•œë¶“ê·¸ë¦¬ê¸°ê°€ ë¶ˆê°€ëŠ¥í•œ ê·¸ë˜í”„ì…ë‹ˆë‹¤.</p>
        <p>ê·¸ë˜ë„ ê³„ì† ë„ì „í•  ìˆ˜ë„ ìˆê³ , í•´ì„¤ì„ ë³¼ ìˆ˜ë„ ìˆì–´ìš”.</p>
        <div class="overlay-buttons">
          <button id="giveup-cancel">ê³„ì† ë„ì „</button>
          <button id="giveup-confirm">í•´ì„¤ ë³´ê¸°</button>
        </div>
      </div>
    </div>

    <!-- í•´ì„¤ ì˜¤ë²„ë ˆì´ -->
    <div id="result-overlay">
      <div class="overlay-box">
        <h3>ì¾¨ë‹ˆíˆìŠ¤ë² ë¥´í¬ì˜ ë‹¤ë¦¬</h3>
        <p>ì´ ê·¸ë˜í”„ëŠ” ì—­ì‚¬ì ìœ¼ë¡œ ìœ ëª…í•œ í•œë¶“ê·¸ë¦¬ê¸° ë¬¸ì œì…ë‹ˆë‹¤.</p>
        <p>
          ê° ë•…(ì„¬)ì„ ì (ì •ì ), ë‹¤ë¦¬ë¥¼ ì„ (ê°„ì„ )ìœ¼ë¡œ ìƒê°í•˜ë©´,
          í™€ìˆ˜ ì°¨ìˆ˜ ì •ì ì´ <strong>4ê°œ</strong>ë¼ì„œ
          í•œë¶“ê·¸ë¦¬ê¸°ê°€ <strong>ìˆ˜í•™ì ìœ¼ë¡œ ë¶ˆê°€ëŠ¥</strong>í•©ë‹ˆë‹¤.
        </p>
        <p>ì¦‰, ëˆ„êµ¬ë„ ì´ ìŠ¤í…Œì´ì§€ë¥¼ ê·œì¹™ëŒ€ë¡œ ê¹° ìˆ˜ ì—†ìŠµë‹ˆë‹¤ ğŸ˜Š</p>
        <div class="overlay-buttons">
          <button id="result-close">ì²˜ìŒ ìŠ¤í…Œì´ì§€ë¡œ</button>
        </div>
      </div>
    </div>
  </div>

  <div id="info"></div>

  <div class="btn-group">
    <button id="reset">í˜„ì¬ ìŠ¤í…Œì´ì§€ ë¦¬ì…‹</button>
    <button id="next" style="display:none;">ë‹¤ìŒ ìŠ¤í…Œì´ì§€</button>
  </div>
</div>

<script>
/* ===========================
   ìŠ¤í…Œì´ì§€ ë°ì´í„°
=========================== */

const levels = [
  {
    id: 1,
    title: "Stage 1 - ê¸°ë³¸ ì—°ìŠµ",
    description: "ê°€ì¥ ë‹¨ìˆœí•œ êµ¬ì¡°ì…ë‹ˆë‹¤. ëª¨ë“  ë‹¤ë¦¬ë¥¼ í•œ ë²ˆì”©ë§Œ ì§€ë‚˜ ë³´ì„¸ìš”.",
    nodes: [
      { id: 0, x: 180, y: 120 },
      { id: 1, x: 420, y: 120 },
      { id: 2, x: 420, y: 280 },
      { id: 3, x: 180, y: 280 }
    ],
    edges: [
      { id:0,a:0,b:1 },
      { id:1,a:1,b:2 },
      { id:2,a:2,b:3 },
      { id:3,a:3,b:0 },
      { id:4,a:0,b:2 }
    ],
    startNode: 0
  },
  {
    id: 2,
    title: "Stage 2 - ë³„ ëª¨ì–‘ ê·¸ë˜í”„",
    description: "ì¤‘ì•™ ì„¬ê³¼ ë„¤ ëª¨ì„œë¦¬ ì„¬ì´ ë³µì¡í•˜ê²Œ ì—°ê²°ëœ ê·¸ë˜í”„ì…ë‹ˆë‹¤.",
    nodes: [
      { id:0,x:300,y:200 },
      { id:1,x:140,y:120 },
      { id:2,x:460,y:120 },
      { id:3,x:460,y:280 },
      { id:4,x:140,y:280 }
    ],
    edges: [
      { id:0,a:0,b:1 },
      { id:1,a:0,b:2 },
      { id:2,a:0,b:3 },
      { id:3,a:0,b:4 },
      { id:4,a:1,b:2 },
      { id:5,a:2,b:3 },
      { id:6,a:3,b:4 }
    ],
    startNode: 2
  },
  {
    id: 3,
    title: "Stage 3 - ìœ¡ê°í˜• ë¯¸ë¡œ",
    description: "ìœ¡ê°í˜• ëª¨ì–‘ìœ¼ë¡œ ì„¬ì´ ë°°ì¹˜ëœ ë³µì¡í•œ ê·¸ë˜í”„ì…ë‹ˆë‹¤.",
    nodes: [
      { id:0,x:300,y:80 },
      { id:1,x:440,y:140 },
      { id:2,x:440,y:260 },
      { id:3,x:300,y:320 },
      { id:4,x:160,y:260 },
      { id:5,x:160,y:140 }
    ],
    edges: [
      { id:0,a:0,b:1 },
      { id:1,a:1,b:2 },
      { id:2,a:2,b:3 },
      { id:3,a:3,b:4 },
      { id:4,a:4,b:5 },
      { id:5,a:5,b:0 },
      { id:6,a:0,b:3 },
      { id:7,a:2,b:5 },
      { id:8,a:0,b:2 }
    ],
    startNode: 3
  },
  {
    id: 4,
    title: "Stage 4 - êµì°¨ ë‹¤ë¦¬",
    description: "ì‚¬ê°í˜• ì„¬ ì‚¬ì´ì— êµì°¨ ë‹¤ë¦¬ê°€ ì—¬ëŸ¬ ê°œ ìˆëŠ” ì–´ë ¤ìš´ ê·¸ë˜í”„ì…ë‹ˆë‹¤.",
    nodes: [
      { id:0,x:140,y:120 },
      { id:1,x:460,y:120 },
      { id:2,x:460,y:280 },
      { id:3,x:140,y:280 }
    ],
    edges: [
      { id:0,a:0,b:1 },
      { id:1,a:1,b:2 },
      { id:2,a:2,b:3 },
      { id:3,a:3,b:0 },
      { id:4,a:0,b:2 },
      { id:5,a:0,b:2 },
      { id:6,a:1,b:3 },
      { id:7,a:1,b:3 },
      { id:8,a:0,b:1 }
    ],
    startNode: 0
  },
  {
    id: 5,
    title: "Stage 5 - ì¾¨ë‹ˆíˆìŠ¤ë² ë¥´í¬ì˜ ë‹¤ë¦¬",
    description: "ì—­ì‚¬ì ìœ¼ë¡œ ìœ ëª…í•œ í•œë¶“ê·¸ë¦¬ê¸° ë¶ˆê°€ëŠ¥ ê·¸ë˜í”„ì…ë‹ˆë‹¤.",
    nodes: [
      { id:0,x:300,y:160 }, // ì¤‘ì•™ ì„¬ C
      { id:1,x:160,y:110 }, // ì™¼ìª½ A
      { id:2,x:440,y:110 }, // ì˜¤ë¥¸ìª½ D
      { id:3,x:300,y:290 }  // ì•„ë˜ B
    ],
    edges: [
      { id:0,a:0,b:1 },
      { id:1,a:0,b:1 },
      { id:2,a:0,b:2 },
      { id:3,a:0,b:2 },
      { id:4,a:0,b:3 },
      { id:5,a:1,b:3 },
      { id:6,a:2,b:3 }
    ],
    startNode: 0
  }
];

/* ===========================
   ì „ì—­ ìƒíƒœ
=========================== */

const startScreen = document.getElementById("start-screen");
const startBtn    = document.getElementById("start-btn");
const gameContainer = document.getElementById("game-container");

const canvas = document.getElementById("canvas");
const ctx    = canvas.getContext("2d");

const infoDiv  = document.getElementById("info");
const resetBtn = document.getElementById("reset");
const nextBtn  = document.getElementById("next");

const overlay       = document.getElementById("overlay");
const giveupCancel  = document.getElementById("giveup-cancel");
const giveupConfirm = document.getElementById("giveup-confirm");

const resultOverlay = document.getElementById("result-overlay");
const resultClose   = document.getElementById("result-close");

let currentLevelIndex = 0;
let usedEdges = {};
let currentNodeId = 0;
let levelCleared = false;
let resetCount = 0;
let cheatArmed = false;

/* ===========================
   ìœ í‹¸ / ì´ˆê¸°í™”
=========================== */

function getLevel() {
  return levels[currentLevelIndex];
}

function initLevel(i) {
  currentLevelIndex = i;
  const level = getLevel();

  usedEdges = {};
  level.edges.forEach(e => usedEdges[e.id] = false);

  currentNodeId = level.startNode;
  levelCleared  = false;
  resetCount    = 0;

  draw();
  updateInfo();
  nextBtn.style.display = "none";
}

/* ===========================
   ê°• ê·¸ë¦¬ê¸°
=========================== */

function drawRiver(level) {
  ctx.save();
  ctx.fillStyle = "#dbeafe"; // ì—°í•œ íŒŒë‘

  if (level.id === 5) {
    // ìœ„ìª½ ê°•
    ctx.beginPath();
    ctx.moveTo(40, 100);
    ctx.quadraticCurveTo(300, 60, 560, 100);
    ctx.lineTo(560, 140);
    ctx.quadraticCurveTo(300, 110, 40, 140);
    ctx.closePath();
    ctx.fill();

    // ì•„ë˜ìª½ ê°•
    ctx.beginPath();
    ctx.moveTo(40, 220);
    ctx.quadraticCurveTo(300, 180, 560, 220);
    ctx.lineTo(560, 260);
    ctx.quadraticCurveTo(300, 230, 40, 260);
    ctx.closePath();
    ctx.fill();
  } else {
    ctx.beginPath();
    ctx.moveTo(80, 140);
    ctx.quadraticCurveTo(300, 110, 520, 140);
    ctx.lineTo(520, 260);
    ctx.quadraticCurveTo(300, 290, 80, 260);
    ctx.closePath();
    ctx.fill();
  }

  ctx.restore();
}

/* ===========================
   ê³¡ì„  ë‹¤ë¦¬
=========================== */

function drawCurve(A, B, offset) {
  const x1 = A.x, y1 = A.y;
  const x2 = B.x, y2 = B.y;

  const mx = (x1 + x2) / 2;
  const my = (y1 + y2) / 2;

  const dx = x2 - x1;
  const dy = y2 - y1;
  const len = Math.sqrt(dx*dx + dy*dy) || 1;
  const nx = -dy / len;
  const ny =  dx / len;

  const curve = 18 * (offset + 1);

  const cx = mx + nx * curve;
  const cy = my + ny * curve;

  ctx.quadraticCurveTo(cx, cy, x2, y2);
}

/* ===========================
   ê·¸ë¦¬ê¸°
=========================== */

function draw() {
  const level = getLevel();

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawRiver(level);

  // ë‹¤ë¦¬
  level.edges.forEach(e => {
    const A = level.nodes.find(n => n.id === e.a);
    const B = level.nodes.find(n => n.id === e.b);

    ctx.beginPath();
    ctx.moveTo(A.x, A.y);

    const used = usedEdges[e.id];
    ctx.lineWidth = 5;
    ctx.strokeStyle = used ? "#bdbdbd" : "#1565c0";

    const offset = e.offsetIndex || 0;
    drawCurve(A, B, offset);
    ctx.stroke();
  });

  // ì„¬
  level.nodes.forEach(n => {
    ctx.beginPath();
    ctx.arc(n.x, n.y, 18, 0, Math.PI * 2);
    ctx.fillStyle = (n.id === currentNodeId) ? "#ffeb3b" : "#ffffff";
    ctx.fill();
    ctx.lineWidth = 2;
    ctx.strokeStyle = "#424242";
    ctx.stroke();

    ctx.fillStyle = "#000000";
    ctx.font = "14px Pretendard";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(n.id, n.x, n.y);
  });
}

/* ===========================
   ì •ë³´ ì—…ë°ì´íŠ¸
=========================== */

function updateInfo(message = "") {
  const level = getLevel();
  const total = level.edges.length;
  const used = Object.values(usedEdges).filter(v => v).length;

  let html = `
    <div><strong>${level.title}</strong></div>
    <div style="margin-top:4px;">${level.description}</div>
    <div style="margin-top:6px;">ì‚¬ìš©í•œ ë‹¤ë¦¬: ${used} / ${total}</div>
    <div>í˜„ì¬ ìœ„ì¹˜í•œ ì„¬ ID: ${currentNodeId}</div>
    <div style="margin-top:6px; font-size:13px; color:#555;">
      ê·œì¹™: ëª¨ë“  ë‹¤ë¦¬ë¥¼ <strong>ë”± í•œ ë²ˆì”©ë§Œ</strong> ì§€ë‚˜ë©´ í´ë¦¬ì–´ì…ë‹ˆë‹¤. ì¶œë°œì§€ë¡œ ëŒì•„ì˜¬ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.
    </div>
  `;

  if (levelCleared && level.id <= 4) {
    html += `<div style="margin-top:6px; color:#2e7d32;"><strong>âœ” í´ë¦¬ì–´! 'ë‹¤ìŒ ìŠ¤í…Œì´ì§€' ë²„íŠ¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</strong></div>`;
  }

  if (message) {
    html += `<div style="margin-top:6px; color:#d32f2f;"><strong>${message}</strong></div>`;
  }

  infoDiv.innerHTML = html;
}

/* ===========================
   ìŠ¹ë¦¬ ì²´í¬
=========================== */

function checkWin() {
  const level = getLevel();
  const total = level.edges.length;
  const used = Object.values(usedEdges).filter(v => v).length;

  if (used === total) {
    levelCleared = true;
    updateInfo("ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë‹¤ë¦¬ë¥¼ í•œ ë²ˆì”©ë§Œ ì§€ë‚˜ê°”ìŠµë‹ˆë‹¤! âœ…");
    if (level.id <= 4) {
      nextBtn.style.display = "inline-block";
    }
    return true;
  }
  return false;
}

/* ===========================
   ìº”ë²„ìŠ¤ í´ë¦­
=========================== */

canvas.addEventListener("click", (event) => {
  const level = getLevel();
  const rect = canvas.getBoundingClientRect();
  const x = event.clientX - rect.left;
  const y = event.clientY - rect.top;

  const clickedNode = level.nodes.find(n => Math.hypot(n.x - x, n.y - y) <= 20);
  if (!clickedNode) return;

  if (clickedNode.id === currentNodeId) {
    updateInfo("ì´ë¯¸ ê·¸ ì„¬ì— ì„œ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì„¬ì„ ëˆŒëŸ¬ ë³´ì„¸ìš”.");
    return;
  }

  const candidateEdges = level.edges.filter(e => {
    const connected =
      (e.a === currentNodeId && e.b === clickedNode.id) ||
      (e.b === currentNodeId && e.a === clickedNode.id);
    return connected && !usedEdges[e.id];
  });

  if (candidateEdges.length === 0) {
    updateInfo("ì´ ë‘ ì„¬ ì‚¬ì´ì— ë” ì´ìƒ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹¤ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const edgeToUse = candidateEdges[0];
  usedEdges[edgeToUse.id] = true;
  currentNodeId = clickedNode.id;

  draw();
  if (!checkWin()) {
    updateInfo();
  }
});

/* ===========================
   ì¹˜íŠ¸ (` + Enter / â† / â†’)
=========================== */

function animateClear() {
  const level = getLevel();
  let i = 0;

  function step() {
    if (i >= level.edges.length) {
      checkWin();
      return;
    }
    usedEdges[level.edges[i].id] = true;
    draw();
    i++;
    setTimeout(step, 130);
  }
  step();
}

document.addEventListener("keydown", (e) => {
  if (gameContainer.style.display === "none") return;

  if (e.key === "`") {
    cheatArmed = true;
    return;
  }
  if (!cheatArmed) return;

  if (e.key === "Enter") {
    animateClear();
  } else if (e.key === "ArrowLeft") {
    initLevel((currentLevelIndex - 1 + levels.length) % levels.length);
  } else if (e.key === "ArrowRight") {
    initLevel((currentLevelIndex + 1) % levels.length);
  }

  cheatArmed = false;
});

/* ===========================
   ë¦¬ì…‹
=========================== */

resetBtn.addEventListener("click", () => {
  const level = getLevel();

  if (level.id === 5) {
    resetCount++;
    if (resetCount >= 5) {
      overlay.style.display = "flex";
      return;
    }
  }

  initLevel(currentLevelIndex);
});

/* ===========================
   ë‹¤ìŒ ìŠ¤í…Œì´ì§€ (ì¡°ê±´ ë‹¨ìˆœí™”)
=========================== */

nextBtn.addEventListener("click", () => {
  // ì–´ì°¨í”¼ ë²„íŠ¼ì€ í´ë¦¬ì–´ í›„ì—ë§Œ ë³´ì´ë„ë¡ í–ˆìœ¼ë¯€ë¡œ
  // ì—¬ê¸°ì„œëŠ” ê·¸ëƒ¥ ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ë„˜ê²¨ë²„ë¦°ë‹¤.
  if (currentLevelIndex < levels.length - 1) {
    initLevel(currentLevelIndex + 1);
  }
});

/* ===========================
   ì˜¤ë²„ë ˆì´
=========================== */

giveupCancel.addEventListener("click", () => {
  overlay.style.display = "none";
});

giveupConfirm.addEventListener("click", () => {
  overlay.style.display = "none";
  resultOverlay.style.display = "flex";
});

resultClose.addEventListener("click", () => {
  resultOverlay.style.display = "none";
  initLevel(0);
});

/* ===========================
   ì‹œì‘ ë²„íŠ¼
=========================== */

startBtn.addEventListener("click", () => {
  startScreen.style.display = "none";
  gameContainer.style.display = "flex";
  initLevel(0);
});
</script>
</body>
</html>
